import './polyfills.server.mjs';
import{a as U}from"./chunk-WXVHVKFO.mjs";import{c as P,e as s,h as I,i as A,j as O,l as m,n as G,q as M,r as R,s as q,t as j,u as L,z as V}from"./chunk-MEKS2M77.mjs";import{a as Q}from"./chunk-BZMZPU7X.mjs";import"./chunk-ZYS5XCCG.mjs";import{a as $}from"./chunk-KX3P2BBH.mjs";import{a as H,b as J,c as K}from"./chunk-X5YKXZNS.mjs";import"./chunk-PFASEQHQ.mjs";import"./chunk-SKN4S5F7.mjs";import"./chunk-UXIQEXPC.mjs";import{a as z}from"./chunk-56BUFAXK.mjs";import{d as B}from"./chunk-T2CJTV2K.mjs";import{Ab as o,Bb as e,Cb as c,Mb as x,Nc as F,Ob as h,Ra as l,_a as p,bc as r,cc as f,eb as E,jb as w,nd as T,pd as N,sc as S,tb as g,tc as y,ub as v,vb as k,xb as _,yb as b,zb as u}from"./chunk-7YNU2WAY.mjs";import{a as d,b as C}from"./chunk-T55IDOPT.mjs";function X(n,t){if(n&1&&(o(0,"option",25),r(1),e()),n&2){let i=t.$implicit;u("value",i.name),l(),f(i.name)}}function Y(n,t){if(n&1&&c(0,"app-tour-cart",40),n&2){let i=h().$implicit;u("tour",i.tour)}}function Z(n,t){n&1&&w(0,Y,1,1,"ng-template",39)}function ee(n,t){if(n&1&&(o(0,"owl-carousel-o",30),_(1,Z,1,0,null,39,k),e()),n&2){let i=h();u("options",i.cartListOptions),l(),b(i.CartData)}}function te(n,t){n&1&&(o(0,"p",31),r(1,"No data found in your cart"),e())}function oe(n,t){if(n&1&&(o(0,"div",38)(1,"h6",33),r(2,"Total Price After Discount"),e(),o(3,"h6",34),r(4),S(5,"currency"),e()()),n&2){let i=h();l(4),f(y(5,1,i.getTotalPrice()))}}var W=class n{constructor(t,i,a,D){this._BookingService=t;this.toaster=i;this._Router=a;this._cdr=D}backgroundImage="../../../assets/image/banner.webp";checkoutForm;AllCountries=[];checkoutData={};haveData=!1;CartData=[];couponApplied=!1;totalPrice=0;ngOnInit(){this.getCountries(),this.getCartData(),this.checkoutForm=new O({first_name:new m("",[s.required]),last_name:new m("",[s.required]),email:new m("",[s.required,s.email]),phone:new m("",[s.required]),state:new m("",[s.required]),country:new m("",[s.required]),notes:new m(""),coupon_id:new m(""),currency_id:new m(1)})}getCheckoutData(){if(console.log(this.checkoutForm.value),console.log(this.checkoutForm.valid),!this.checkoutForm.valid)return;this.checkoutData=d({},this.checkoutForm.value),this.checkoutForm.get("coupon_id")?.value?.trim()&&this.couponApplied?(this.applyCoupon(),this.sendCheckoutData(),this.CartData=[],this.haveData=!1,this._Router.navigate(["/"]),this.toaster.success("Order placed successfully")):(this.checkoutData=C(d({},this.checkoutData),{coupon_id:""}),this.sendCheckoutData(),this.CartData=[],this.haveData=!1,this._Router.navigate(["/"]),this.toaster.success("Order placed successfully"))}applyCoupon(){let t=this.checkoutForm.get("coupon_id")?.value?.trim();t&&t!==""?this._BookingService.getCoupon(t).subscribe({next:i=>{this.toaster.success(i.message),setTimeout(()=>{i.data?.id&&(this.checkoutData=C(d({},this.checkoutData),{coupon_id:i.data.id}),this.couponApplied=!0),this._cdr.markForCheck()},0)},error:i=>{this.toaster.error(i.error?.message||"Invalid coupon code"),setTimeout(()=>{this.couponApplied=!1,this._cdr.markForCheck()},0)}}):(this.toaster.error("Please enter a coupon code"),setTimeout(()=>{this.couponApplied=!1,this._cdr.markForCheck()},0))}sendCheckoutData(){this._BookingService.sendCheckoutData(this.checkoutData).subscribe({next:t=>{this.toaster.success(t.message),this.checkoutForm.reset()},error:t=>{this.toaster.error(t.error?.message||"Error submitting checkout")}})}getCartData(){this._BookingService.getCartList().subscribe({next:t=>{setTimeout(()=>{this.CartData=t.data,this.CartData.length>0?this.haveData=!0:this.haveData=!1,this.totalPrice=this.calculateTotalPrice(),this._cdr.markForCheck(),console.log("CartData",this.CartData)},0)},error:t=>{console.log("Error",t)}})}calculateTotalPrice(){return!this.CartData||this.CartData.length===0?0:this.CartData.reduce((t,i)=>t+(i.totalPrice||0),0)}getTotalPrice(){return this.totalPrice}getCountries(){this._BookingService.getCountries().subscribe({next:t=>{setTimeout(()=>{this.AllCountries=t.data,this._cdr.markForCheck(),console.log("AllCountries",this.AllCountries)},0)},error:t=>{console.log("Error",t)}})}cartListOptions={loop:!0,mouseDrag:!0,touchDrag:!0,pullDrag:!0,dots:!0,smartSpeed:2500,navText:["",""],items:1,autoplay:!0,margin:20,nav:!1};static \u0275fac=function(i){return new(i||n)(p(U),p($),p(B),p(F))};static \u0275cmp=E({type:n,selectors:[["app-checkout"]],decls:66,vars:10,consts:[[3,"title","subtitle","backgroundImage"],[1,"my-5"],[1,"container"],[1,"row","g-3"],[1,"col-lg-8"],[1,"bg-light","p-3","rounded-3","shadow-sm","border"],[1,"text-start"],[1,"h3","fw-bold"],[1,"fontsm"],[1,"row","g-3",3,"ngSubmit","formGroup"],[1,"col-md-6"],["for","first_name",1,"form-label"],["type","text","id","first_name","formControlName","first_name","placeholder","First Name",1,"form-control"],["for","last_name",1,"form-label"],["type","text","id","last_name","formControlName","last_name","placeholder","Last Name",1,"form-control"],["for","email",1,"form-label"],["type","email","id","email","formControlName","email","placeholder","Email",1,"form-control"],["for","phone",1,"form-label"],["type","tel","id","phone","formControlName","phone","placeholder","Phone",1,"form-control"],["for","state",1,"form-label"],["type","text","id","state","formControlName","state","placeholder","State",1,"form-control"],[1,"col-12"],["for","country",1,"form-label"],["id","country","formControlName","country",1,"form-control"],["value","","disabled","","selected",""],[3,"value"],["for","notes",1,"form-label"],["id","notes","formControlName","notes","placeholder","Notes","rows","3",1,"form-control"],["type","submit",1,"mainBtn","w-100","mt-3"],[1,"col-lg-4"],[3,"options"],[1,"text-center","text-danger"],[1,"flexBetween","mt-4"],[1,"mb-1"],[1,"mb-1","textMainColor","fw-bold"],[1,"form-group","flexBetween","gap-3","my-3",3,"formGroup"],["type","text","id","coupon","formControlName","coupon_id","placeholder","Enter coupon code",1,"form-control"],["type","button",1,"btn","secBtn","flex-shrink-0",3,"click"],[1,"flexBetween"],["carouselSlide",""],[3,"tour"]],template:function(i,a){i&1&&(c(0,"app-banner",0),o(1,"section",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6)(7,"h2",7),r(8,"Billing Details"),e(),o(9,"p",8),r(10,"Please fill in the details below to complete your purchase"),e()(),o(11,"form",9),x("ngSubmit",function(){return a.getCheckoutData()}),o(12,"div",10)(13,"label",11),r(14,"First Name"),e(),c(15,"input",12),e(),o(16,"div",10)(17,"label",13),r(18,"Last Name"),e(),c(19,"input",14),e(),o(20,"div",10)(21,"label",15),r(22,"Email"),e(),c(23,"input",16),e(),o(24,"div",10)(25,"label",17),r(26,"Phone"),e(),c(27,"input",18),e(),o(28,"div",10)(29,"label",19),r(30,"state"),e(),c(31,"input",20),e(),o(32,"div",21)(33,"label",22),r(34,"Country"),e(),o(35,"select",23)(36,"option",24),r(37,"Select Country"),e(),_(38,X,2,2,"option",25,k),e()(),o(40,"div",21)(41,"label",26),r(42,"Notes"),e(),c(43,"textarea",27),e(),o(44,"button",28),r(45,"Submit Order"),e()()()(),o(46,"div",29)(47,"div")(48,"div",6)(49,"h2",7),r(50,"Order Summary"),e(),o(51,"p",8),r(52,"Please review the details below to complete your purchase"),e()(),g(53,ee,3,1,"owl-carousel-o",30)(54,te,2,0,"p",31),o(55,"div",32)(56,"h6",33),r(57,"Total Price"),e(),o(58,"h6",34),r(59),S(60,"currency"),e()(),o(61,"div",35),c(62,"input",36),o(63,"button",37),x("click",function(){return a.applyCoupon()}),r(64," Apply "),e()(),g(65,oe,6,3,"div",38),e()()()()()),i&2&&(u("title","Checkout")("subtitle","Complete your purchase")("backgroundImage",a.backgroundImage),l(11),u("formGroup",a.checkoutForm),l(27),b(a.AllCountries),l(15),v(a.haveData?53:54),l(6),f(y(60,8,a.getTotalPrice())),l(2),u("formGroup",a.checkoutForm),l(4),v(a.couponApplied?65:-1))},dependencies:[z,N,V,G,j,L,P,q,I,A,M,R,Q,K,J,H,T],styles:[".checkout-container[_ngcontent-%COMP%]{padding:2rem}"]})};export{W as CheckoutComponent};
