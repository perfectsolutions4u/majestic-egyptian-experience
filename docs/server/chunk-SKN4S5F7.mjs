import './polyfills.server.mjs';
import{b as d}from"./chunk-UXIQEXPC.mjs";import{Bd as h,Cd as f,Fa as p,V as a,Z as b,ba as c,k as l,sd as n}from"./chunk-7YNU2WAY.mjs";import{a as g,b as u}from"./chunk-T55IDOPT.mjs";var m=class o extends d{constructor(t,e){super(t);this.HttpClient=t;this.platformId=e;n(this.platformId)&&this.initializeAutoRefresh()}STORAGE_KEYS={destinations:"majestic_destinations",settings:"majestic_settings",countries:"majestic_countries",durations:"majestic_durations",categories:"majestic_categories"};CACHE_EXPIRATION_TIME=360*1e3;sessionFetchFlags={destinations:!1,settings:!1,countries:!1,durations:!1,categories:!1};refreshIntervals=new Map;ngOnDestroy(){this.refreshIntervals.forEach(t=>{t&&clearInterval(t)}),this.refreshIntervals.clear()}getFromLocalStorage(t){if(!n(this.platformId))return null;try{let e=localStorage.getItem(t);if(!e)return null;let s=JSON.parse(e);return s&&typeof s=="object"&&"data"in s&&"timestamp"in s?s:null}catch(e){return console.warn(`Error reading from localStorage for key ${t}:`,e),null}}setToLocalStorage(t,e){if(n(this.platformId))try{let s={data:e,timestamp:Date.now()};localStorage.setItem(t,JSON.stringify(s))}catch(s){console.warn(`Error writing to localStorage for key ${t}:`,s)}}isCacheExpired(t){return!t||!t.timestamp?!0:Date.now()-t.timestamp>this.CACHE_EXPIRATION_TIME}initializeAutoRefresh(){[{key:"destinations",fetchFn:()=>{(()=>{let s=new h().set("parent_id",1).set("page",1);return this.HttpClient.get(`${this.baseUrl}/destinations`,{params:s})})().pipe(a(s=>{s&&this.setToLocalStorage(this.STORAGE_KEYS.destinations,s)})).subscribe()}},{key:"settings",fetchFn:()=>{this.HttpClient.get(`${this.baseUrl}/settings`).pipe(a(e=>{e&&this.setToLocalStorage(this.STORAGE_KEYS.settings,e)})).subscribe()}},{key:"countries",fetchFn:()=>{this.HttpClient.get(`${this.baseUrl}/countries`).pipe(a(e=>{e&&this.setToLocalStorage(this.STORAGE_KEYS.countries,e)})).subscribe()}},{key:"durations",fetchFn:()=>{this.HttpClient.get(`${this.baseUrl}/durations`).pipe(a(e=>{e&&this.setToLocalStorage(this.STORAGE_KEYS.durations,e)})).subscribe()}},{key:"categories",fetchFn:()=>{this.HttpClient.get(`${this.baseUrl}/categories`).pipe(a(e=>{e&&this.setToLocalStorage(this.STORAGE_KEYS.categories,e)})).subscribe()}}].forEach(({key:e,fetchFn:s})=>{let i=setInterval(()=>{s()},this.CACHE_EXPIRATION_TIME);this.refreshIntervals.set(e,i)})}getCachedOrFetch(t,e,s){let i=this.getFromLocalStorage(t);if(this.isCacheExpired(i)||!this.sessionFetchFlags[e])return this.sessionFetchFlags[e]=!0,s().pipe(a(r=>{r&&this.setToLocalStorage(t,r)}));if(i&&i.data){let r=i.data;return r&&typeof r=="object"&&"data"in r?l(r):l(r)}return s().pipe(a(r=>{r&&this.setToLocalStorage(t,r)}))}clearAllCache(){n(this.platformId)&&(Object.values(this.STORAGE_KEYS).forEach(t=>{localStorage.removeItem(t)}),this.sessionFetchFlags={destinations:!1,settings:!1,countries:!1,durations:!1,categories:!1})}getTours(t,e=1){let s=u(g({includes:"destinations,categories,days,seo,options"},t),{page:e});return this.HttpClient.get(`${this.baseUrl}/tours`,{params:s})}getTourBySlug(t){return this.HttpClient.get(`${this.baseUrl}/tours/${t}?includes=destinations,categories,days,seo,options`)}toggleWishlist(t){return this.HttpClient.put(`${this.baseUrl}/wishlist/${t}/toggle`,{})}getWishlist(){return this.HttpClient.get(`${this.baseUrl}/wishlist`)}getDestination(t=1,e=1){let s=()=>{let i=new h;return t&&(i=i.set("parent_id",t)),e&&(i=i.set("page",e)),this.HttpClient.get(`${this.baseUrl}/destinations`,{params:i})};return this.getCachedOrFetch(this.STORAGE_KEYS.destinations,"destinations",s)}getDestinationBySlug(t){return this.HttpClient.get(`${this.baseUrl}/destinations/${t}?includes=seo`)}getCategory(){let t=()=>this.HttpClient.get(`${this.baseUrl}/categories`);return this.getCachedOrFetch(this.STORAGE_KEYS.categories,"categories",t)}getCategoryBySlug(t){return this.HttpClient.get(`${this.baseUrl}/categories/${t}`)}getSetting(){let t=()=>this.HttpClient.get(`${this.baseUrl}/settings`);return this.getCachedOrFetch(this.STORAGE_KEYS.settings,"settings",t)}getCountries(){let t=()=>this.HttpClient.get(`${this.baseUrl}/countries`);return this.getCachedOrFetch(this.STORAGE_KEYS.countries,"countries",t)}getDurations(){let t=()=>this.HttpClient.get(`${this.baseUrl}/durations`);return this.getCachedOrFetch(this.STORAGE_KEYS.durations,"durations",t)}getBlogs(t=1){return this.HttpClient.get(`${this.baseUrl}/blogs?page=${t}`)}getBlogBySlug(t){return this.HttpClient.get(`${this.baseUrl}/blogs/${t}`)}getBlogCategories(){return this.HttpClient.get(`${this.baseUrl}/blog-categories`)}getBlogCategoriesDetails(t){return this.HttpClient.get(`${this.baseUrl}/blog-categories/${t}`)}getFaqs(){return this.HttpClient.get(`${this.baseUrl}/faqs`)}getreviews(){return this.HttpClient.get(`${this.baseUrl}/tour-reviews`)}getreviewByTourId(t){return this.HttpClient.get(`${this.baseUrl}/tour-reviews/${t}`)}writeReview(t,e){return this.HttpClient.post(`${this.baseUrl}/tour-reviews/${t}`,e)}sendContactData(t){return this.HttpClient.post(`${this.baseUrl}/contact-requests`,t)}static \u0275fac=function(e){return new(e||o)(c(f),c(p))};static \u0275prov=b({token:o,factory:o.\u0275fac,providedIn:"root"})};export{m as a};
